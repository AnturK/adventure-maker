{"version":3,"sources":["Helpers.js","State.js","ExternalDefines.js","images/default.png","images/grue.png","images/signal_lost.png","images/trade.png","Components/EffectBuilder.js","Components/RequirementsBuilder.js","Components/Utility.js","Components/AdventureChoice.js","Components/AdventureNode.js","Components/AdventureTrigger.js","Components/AdventurePlayer.js","Components/AdventureEditor.js","App.js","reportWebVitals.js","index.js"],"names":["replaceItemInArray","arr","oldVal","newValue","modifed","slice","indexOf","updateProp","obj","prop_name","new_value","convertNumberValue","value","as_number","Number","isFinite","isNaN","global_ids","unique_id","category","NodeData","this","id","name","description","choices","image","image_raw","undefined","on_enter_effects","on_exit_effects","TriggerData","target_node","on_trigger_effects","requirements","ChoiceData","key","exit_node","on_selection_effects","delay","delay_message","EffectData","effect_type","quality","ReqGroupData","group_type","ReqData","operator","AdventureState","atom","default","starting_node","nodes","triggers","required_site_traits","loot_types","band_modifiers","starting_qualities","deep_scan_description","author","NodesSelector","selector","get","NodeSelector","selectorFamily","find","x","set","current","modified","TriggersSelector","TriggerSelector","special_nodes","site_traits","scan_bands","preset_images","grue","signal_lost","trader","EffectTypes","Add","Set","Remove","ValueTypes","raw","random","Effect","props","handleChange","handleDelete","value_type","effect","Object","InputGroup","FormControl","as","onChange","e","target","keys","map","k","Prepend","Text","low","high","value_type_controls","Append","Button","onClick","allowed_types","current_index","new_type","length","defaultForValueType","variant","EffectBuilder","handleEffectsChanged","handleEffectAdded","handleEffectDeleted","add_effect","effects","Card","Header","title","ListGroup","ListGroupItem","prop","RequirementsBuilder","handleRequirementsChanged","handleRequirementAdded","handleRequirementDeleted","add_req","req","ReqGroup","group","handleReqGroupChanged","handleReqGroupDeleted","SingleReq","requirement","handleReqChanged","handleReqDeleted","Item","ButtonGroup","deleteSubReq","deleted","new_reqs","filter","updateSubReq","old_req","changed_req","border","new_group","new_req","BasicCollapsible","useState","startCollapsed","sectionCollapsed","setSectionCollapsed","Container","Row","Col","className","children","NodeSelectionDropdown","allowNone","allowCustom","rest","useRecoilState","node","KeyValueList","presetKeys","adventureProp","adventure","setAdventure","store","newKey","setNewKey","setNewValue","store_keys","Table","size","newstore","remove_key","pk","SimpleList","presetValues","unique","FormGroup","remove_value","AdventureChoice","handleChoiceDeletion","handleChoiceChange","choice","exitNodeSelectValue","setExitNodeSelectValue","Body","added","effect_prop","new_effect","old_effects","new_effects","addEffect","old","old_effect","changed_prop","changed_effect","updateEffects","removed","deleteEffect","old_reqs","AdventureNode","handleNodeDeletion","setNode","current_image","raw_image","imageInput","useRef","image_name_text","Title","Image","src","width","height","Form","Control","readOnly","File","type","accept","ref","reader","FileReader","onload","uploaded_image","document","createElement","modified_node","result","alert","readAsDataURL","files","style","display","click","Label","rows","placeholder","parent_id","new_choices","removeChoice","choice_property","new_choice","old_choice","updateChoice","addChoice","AdventureTrigger","handleDeletion","trigger","setTrigger","AdventurePlayer","currentNode","setCurrentNode","qualities","setQualities","prevNode","setPrevNode","checkReq","check_group","req_group","checkChoice","navigateToNode","node_name","apply_effects","next_node","triggerGuard","checkTriggers","includes","push","extractValue","min","max","Math","ceil","floor","effect_list","extractedValue","a","b","c","Alert","Img","disabled","selectChoice","qname","AdventureEditor","activeTab","setActiveTab","draggedItem","setDraggedItem","regenerate_reqs","req_list","regenerate_effects","ImportInput","ExportLink","openTab","toString","getDefaultTab","startingNode","getDefaultStartingNode","playing","setPlaying","toggle_playing","Modal","show","onHide","data_object","adventure_name","loot_categories","scan_band_mods","blob","Blob","JSON","stringify","blob_url","URL","createObjectURL","href","download","parse","reindexed_nodes","node_list","regenerate_ids","reindexed_triggers","trigger_list","regenerate_trigger_ids","modified_adventure","readAsText","Tab","activeKey","onSelect","Nav","draggable","onDragEnd","onDragStart","start_dragging","onDrop","index_a","index_b","modified_nodes","switch_node","onDragOver","preventDefault","validate_drop","Link","eventKey","Content","Pane","changed_nodes","delete_node","xl","changed_triggers","delete_trigger","App","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.ab1a0e4e.chunk.js","sourcesContent":["//Helpers\r\nexport function replaceItemInArray(arr, oldVal, newValue) {\r\n    const modifed = arr.slice()\r\n    modifed[arr.indexOf(oldVal)] = newValue\r\n    return modifed\r\n}\r\n\r\nexport function updateProp(obj, prop_name, new_value) {\r\n    return { ...obj, [prop_name]: new_value }\r\n}\r\n\r\nexport function convertNumberValue(value){\r\n    const as_number = Number(value)\r\n    if(Number.isFinite(as_number) && !Number.isNaN(as_number)){\r\n      return as_number\r\n    }\r\n    return value;\r\n  }","import { atom, selector, selectorFamily} from 'recoil'\r\nimport {replaceItemInArray} from './Helpers'\r\n\r\n/// Eugh\r\nexport const global_ids = {};\r\nexport function unique_id(category) {\r\n    category in global_ids ? global_ids[category] += 1 : global_ids[category] = 0\r\n    return `${category} ${global_ids[category]}`\r\n}\r\n\r\n//Data classes\r\nexport class AdventureData {\r\n    constructor() {\r\n        this.name = \"New adventure\"\r\n        this.starting_node = \"\"\r\n        this.nodes = []\r\n        this.triggers = []\r\n        this.required_site_traits = []\r\n        this.loot_types = []\r\n        this.band_modifiers = {}\r\n        this.starting_qualities = {}\r\n        this.deep_scan_description  = \"\"\r\n        this.author = \"Anonymous\"\r\n    }\r\n}\r\n\r\nexport class NodeData {\r\n    constructor() {\r\n        this.id = unique_id(\"Node\")\r\n        this.name = this.id\r\n        this.description = \"Node description goes here\"\r\n        this.choices = []\r\n        this.image = \"default\"\r\n        this.image_raw = undefined\r\n        this.on_enter_effects = undefined\r\n        this.on_exit_effects = undefined\r\n    }\r\n}\r\n\r\nexport class TriggerData{\r\n    constructor(){\r\n        this.id = unique_id(\"trigger\")\r\n        this.name = \"Trigger\"\r\n        this.target_node = undefined\r\n        this.on_trigger_effects = undefined\r\n        this.requirements = undefined\r\n    }\r\n}\r\n\r\nexport class ChoiceData {\r\n    constructor() {\r\n        this.id = unique_id(\"choice\")\r\n        this.key = this.id\r\n        this.name = \"New Choice\"\r\n        this.exit_node = \"FAIL\"\r\n        this.on_selection_effects = undefined\r\n        this.requirements = undefined\r\n        this.delay = 0\r\n        this.delay_message = undefined\r\n    }\r\n}\r\n\r\nexport class EffectData {\r\n    constructor() {\r\n        this.id = unique_id(\"effect\")\r\n        this.effect_type = \"Add\"\r\n        this.quality = \"Quality\"\r\n        this.value = 1\r\n    }\r\n}\r\n\r\nexport class ReqGroupData {\r\n    constructor() {\r\n        this.id = unique_id(\"req\")\r\n        this.group_type = \"AND\"\r\n        this.requirements = []\r\n    }\r\n}\r\n\r\nexport class ReqData {\r\n    constructor() {\r\n        this.id = unique_id(\"req\")\r\n        this.quality = \"Quality\"\r\n        this.operator = \"==\"\r\n        this.value = 1\r\n    }\r\n}\r\n\r\nexport const AdventureState = atom({\r\n    key: \"adventure\",\r\n    default: new AdventureData(),\r\n})\r\n\r\nexport const NodesSelector = selector({\r\n    key: \"nodes\",\r\n    get: ({ get }) => {\r\n        const adventure = get(AdventureState)\r\n        return adventure.nodes\r\n    }\r\n})\r\n\r\nexport const NodeSelector = selectorFamily({\r\n    key: \"single_node\",\r\n    get: (id) => ({ get }) => {\r\n        const adventure = get(AdventureState);\r\n        return adventure.nodes.find(x => x.id === id)\r\n    },\r\n    set: (id) => ({ set, get }, newValue) => {\r\n        const current = get(AdventureState)\r\n        const modified = { ...current, nodes: replaceItemInArray(current.nodes, current.nodes.find(x => x.id === id), newValue) }\r\n        set(AdventureState, modified)\r\n    }\r\n})\r\n\r\nexport const TriggersSelector = selector({\r\n    key: \"triggers\",\r\n    get: ({ get }) => {\r\n        const adventure = get(AdventureState)\r\n        return adventure.triggers\r\n    }\r\n})\r\n\r\nexport const TriggerSelector = selectorFamily({\r\n    key: \"single_trigger\",\r\n    get: (id) => ({ get }) => {\r\n        const adventure = get(AdventureState);\r\n        return adventure.triggers.find(x => x.id === id)\r\n    },\r\n    set: (id) => ({ set, get }, newValue) => {\r\n        const current = get(AdventureState)\r\n        const modified = { ...current, triggers: replaceItemInArray(current.triggers, current.triggers.find(x => x.id === id), newValue) }\r\n        set(AdventureState, modified)\r\n    }\r\n})\r\n","import signal_lost from './images/signal_lost.png'\r\nimport grue from './images/grue.png'\r\nimport trader from './images/trade.png'\r\nimport default_image from './images/default.png'\r\n\r\nexport const special_nodes = [\"FAIL\",\"FAIL_DEATH\",\"WIN\",\"GO_BACK\"]\r\n\r\nexport const site_traits = [\"ruins\",\"technology present\",\"space station\",\"alien\",\"habitable\",\"spaceship\",\"in space\",\"on surface\"]\r\n\r\nexport const scan_bands = [\"Plasma absorption band\",\"Hydrocarbons/Molecular oxygen\",\"Narrow-band radio waves\",\"Exotic Radiation\",\"Increased Density\"]\r\n\r\nexport const loot_types = [\"maint\",\"drugs\",\"research\",\"weapons\",\"pets\",\"unique\"]\r\n\r\n\r\nexport const preset_images = {\r\n    default : default_image,\r\n    grue : grue,\r\n    signal_lost : signal_lost,\r\n    trader : trader\r\n}\r\n\r\nexport const EffectTypes = {\r\n    Add : \"Add\",\r\n    Set : \"Set\",\r\n    Remove : \"Remove\",\r\n}\r\n\r\nexport const ValueTypes = {\r\n    raw : \"raw\",\r\n    random : \"random\"\r\n}","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAABkBAMAAAAxqGI4AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAGUExURQAAAP8AABv/jSIAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAC7SURBVGje7ZdBDsJADAPjH2T//1lAgNrlxMVDiTynnjKyu6m6FUIIIfyA9aCtCq0XhMNo0bMoWRt7j3Za7rOPJ5fkNNj3Vk5zbVGOtiCJra9trFHSm6TdEvkka46kR0i2uX8t2bZRri+kPpax3FCSdjtESdwOpK0a05agtuwOJIiAIEUEKSKIGMmQtooIIiKIprQFSSqS71FHcjVJCD6gHzvmsuiOogVcSSO5ngQ5XcyeMDegEEIIYTBVNw34EbwIRO7ZAAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAABkBAMAAAAxqGI4AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJUExURQAAAP8AAP8hAFWgYwIAAAAJcEhZcwAADsMAAA7DAcdvqGQAAABbSURBVGje7dPBDYAgEEVBtAKXCmT7L1LucgRi4kwDL/nZLQAAAAAAAPxQXOsbR8SGSG3rKy0zB+m5G/ZG3q/G5A3PQeTMDRNGjeU312+htuWRjLbheQAA+KxSHrpcA/wdxXfnAAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAABkBAMAAAAxqGI4AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAGUExURQAAAP8AABv/jSIAAAAJcEhZcwAADsIAAA7CARUoSoAAAADZSURBVGje7ZNRFoQgCADhBnD/y66AWenbLb935vXK1BwhEQAAAAAAAACAv0LdXLzR2tVsPepuItWZ9Gb0xgxzvww+k7Prk978LvHo1rjvSTQWb4/cYry1q9bLjnMvdWvzwhMRy4bEhqSamb5cZpHUhD66Jck0D4m8kNTIjqTy3CXxK9QsM9hDXCXqcyrfae6SfgZK4qfED6+67UnWf/IkcZmjfCPR83SlREeuJkk/XVUuW5Lc81QnkUG9FYMf5XSZuxPJWD4e9lNSIehUqAAAAAAAAAAAAFdEPmbgEwxTT+ziAAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAABkBAMAAAAxqGI4AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJUExURQAAAP/YAH8zAHXkPMkAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAF8SURBVGje7dkLbsMgDAZg8AnwDbzd/5BTk3aD+A9Ngp2ChvuSIuoP2W4TtWHGjBkzZsyYMWxE5uSYnpfwEuKa3il7vnmxz643b4rsVJ6+TbLnm9fdbUb05i2RvbGJ+pDIpaZUxsYO+X37DQgqtkYoCBkjeoRHQFCxNSLLbTgk6s9OG4KKvYOQM0KhfwQVW3/X34LI6945Qs4IKvZ6ltmsegj07xFUbI1I9jBC9HXFAAgs9j5CjggFc+R5McZmCCp2BbnWlGOIDITkxX4aWef/8l9pCuyoQigMhGTFjtaI1BAuVhXPPSPkhsBicxUhayTlq/pGYLHryPmmICQqRFwRNkfoIHK2KbCjCqFgjzBCslNME/J6yZG0rioPnWyKHEKEi0guyFeJcBOyFi++Rc79mgrHpkCWznMzosZGI6HFwGMDkNBg4LFhgKBLsaMBx6apNgeQ5IHwHQhKGM0RMDYbxOaPhu3YuCB7qCvCn0DSRCoRP4LwqMiMGb1GCD/OSlYEGoUISwAAAABJRU5ErkJggg==\"","import { Button, Card, ListGroup, FormControl, ListGroupItem, InputGroup } from 'react-bootstrap'\r\nimport { EffectData } from './../State'\r\nimport { convertNumberValue} from '../Helpers'\r\nimport { ValueTypes,EffectTypes } from '../ExternalDefines'\r\n\r\nfunction Effect(props) {\r\n    const handleChange = props.handleChange\r\n    const handleDelete = props.handleDelete\r\n    const value_type = props.effect.value === Object(props.effect.value) ? props.effect.value[\"value_type\"] : \"raw\"\r\n\r\n    const defaultForValueType = value_type => {\r\n        switch(value_type){\r\n            case ValueTypes.raw:\r\n                return 0\r\n            case ValueTypes.random:\r\n               return { \"value_type\": ValueTypes.random, \"low\": 0, \"high\": 0 }\r\n            default:\r\n                return 0\r\n        }\r\n    }\r\n\r\n    const toggleSpecialValueType = e => {\r\n        const allowed_types = Object.keys(ValueTypes).map(k => ValueTypes[k])\r\n        const current_index = allowed_types.indexOf(value_type)\r\n        const new_type = allowed_types[(current_index+1)%allowed_types.length]\r\n        handleChange(\"value\",defaultForValueType(new_type))\r\n    }\r\n\r\n    const value_type_controls = value_type => {\r\n        switch (value_type) {\r\n            case \"random\":\r\n                return (\r\n                    <>\r\n                        <InputGroup.Text>Random</InputGroup.Text>\r\n                        <FormControl value={props.effect.value.low} onChange={e => handleChange(\"value\", {...props.effect.value,low:convertNumberValue(e.target.value)})} />\r\n                        <InputGroup.Text>To</InputGroup.Text>\r\n                        <FormControl value={props.effect.value.high} onChange={e => handleChange(\"value\",{...props.effect.value,high:convertNumberValue(e.target.value)})} />\r\n                    </>\r\n                )\r\n            case \"raw\":\r\n                return (<FormControl value={props.effect.value} onChange={e => handleChange(\"value\", convertNumberValue(e.target.value))} />)\r\n            default:\r\n                return (<InputGroup.Text>Unsupported</InputGroup.Text>)\r\n        }\r\n    }\r\n\r\n    return (\r\n        <InputGroup>\r\n            <FormControl as=\"select\" value={props.effect.effect_type} onChange={e => handleChange(\"effect_type\", e.target.value)}>\r\n                {Object.keys(EffectTypes).map(k => (<option key={k}>{EffectTypes[k]}</option>))}\r\n            </FormControl>\r\n            <InputGroup.Prepend>\r\n                <InputGroup.Text>Quality</InputGroup.Text>\r\n            </InputGroup.Prepend>\r\n            <FormControl value={props.effect.quality} onChange={e => handleChange(\"quality\", e.target.value)} />\r\n            <InputGroup.Prepend>\r\n                <InputGroup.Text>Value</InputGroup.Text>\r\n            </InputGroup.Prepend>\r\n            {value_type_controls(value_type)}\r\n\r\n            <InputGroup.Append>\r\n                <Button onClick={toggleSpecialValueType}>*</Button>\r\n                <Button variant=\"danger\" onClick={handleDelete}>Delete</Button>\r\n            </InputGroup.Append>\r\n        </InputGroup>)\r\n}\r\n\r\nexport function EffectBuilder(props) {\r\n    const handleEffectsChanged = props.handleEffectsChanged\r\n    const handleEffectAdded = props.handleEffectAdded\r\n    const handleEffectDeleted = props.handleEffectDeleted\r\n    function add_effect() {\r\n        handleEffectAdded(new EffectData())\r\n    }\r\n\r\n    if (!props.effects)\r\n        return (\r\n            <InputGroup>\r\n                <InputGroup.Prepend>\r\n                    <InputGroup.Text>\r\n                        {props.title}\r\n                    </InputGroup.Text>\r\n                </InputGroup.Prepend>\r\n                <InputGroup.Append>\r\n                    <Button onClick={add_effect}>Create Effect</Button>\r\n                </InputGroup.Append>\r\n            </InputGroup>\r\n        )\r\n    return (\r\n        <>\r\n            <Card.Header>{props.title}</Card.Header>\r\n            <ListGroup>\r\n                {props.effects.map(effect => (\r\n                    <ListGroupItem key={effect.id}>\r\n                        <Effect\r\n                            effect={effect}\r\n                            handleChange={(prop, value) => handleEffectsChanged(effect, prop, value)}\r\n                            handleDelete={(prop, value) => handleEffectDeleted(effect, prop, value)} />\r\n                    </ListGroupItem>))}\r\n                <ListGroupItem>\r\n                    <Button onClick={add_effect}>Add New Effect</Button>\r\n                </ListGroupItem>\r\n            </ListGroup>\r\n        </>)\r\n}","import {ReqGroupData,ReqData} from '../State'\r\nimport {InputGroup,Button,Card,ListGroup,FormControl,ButtonGroup} from 'react-bootstrap'\r\nimport {convertNumberValue} from '../Helpers'\r\n\r\nexport function RequirementsBuilder(props) {\r\n    const handleRequirementsChanged = props.handleRequirementsChanged\r\n    const handleRequirementAdded = props.handleRequirementAdded\r\n    const handleRequirementDeleted = props.handleRequirementDeleted\r\n  \r\n    function add_req_group() {\r\n      handleRequirementAdded(new ReqGroupData())\r\n    }\r\n  \r\n    function add_req() {\r\n      handleRequirementAdded(new ReqData())\r\n    }\r\n  \r\n    if (!props.requirements) {\r\n      return (\r\n      <InputGroup>\r\n        <InputGroup.Prepend>\r\n          <InputGroup.Text>\r\n            {props.title}\r\n          </InputGroup.Text>\r\n        </InputGroup.Prepend>\r\n        <InputGroup.Append>\r\n          <Button onClick={add_req}>Add Requirements</Button>\r\n        </InputGroup.Append>\r\n      </InputGroup>)\r\n    }\r\n    return (\r\n      <>\r\n      <Card.Header>{props.title}</Card.Header>\r\n      <ListGroup>\r\n        {props.requirements.map(req => {\r\n          return req.requirements ? (\r\n            <ReqGroup\r\n              key={req.id} \r\n              group={req}\r\n              handleReqGroupChanged={(prop_name,new_value) => handleRequirementsChanged(req, prop_name, new_value)}\r\n              handleReqGroupDeleted={() => handleRequirementDeleted(req)}\r\n              />) :\r\n            (<SingleReq \r\n              key={req.id}\r\n              requirement={req}\r\n              handleReqChanged={(prop_name, new_value) => handleRequirementsChanged(req, prop_name, new_value)}\r\n              handleReqDeleted={() => handleRequirementDeleted(req)}\r\n            />)\r\n        })}\r\n        <ListGroup.Item>\r\n          <ButtonGroup>\r\n            <Button onClick={add_req_group}>Add Req Group</Button>\r\n            <Button onClick={add_req}>Add Single Req</Button>\r\n          </ButtonGroup>\r\n        </ListGroup.Item>\r\n      </ListGroup></>)\r\n  }\r\n\r\n\r\n  \r\n  function SingleReq(props) {\r\n    const handleReqDeleted = props.handleReqDeleted\r\n    const handleReqChanged = props.handleReqChanged\r\n    return (\r\n      <InputGroup>\r\n        <InputGroup.Prepend>\r\n          <InputGroup.Text>Quality</InputGroup.Text>\r\n        </InputGroup.Prepend>\r\n        <FormControl value={props.requirement.quality} onChange={e => handleReqChanged(\"quality\", e.target.value)} />\r\n        <FormControl as=\"select\" value={props.requirement.operator} onChange={e => handleReqChanged(\"operator\", e.target.value)}>\r\n          <option>==</option>\r\n          <option>!=</option>\r\n          <option>&gt;</option>\r\n          <option>&lt;</option>\r\n          <option>&gt;=</option>\r\n          <option>&lt;=</option>\r\n        </FormControl>\r\n        <FormControl value={props.requirement.value} onChange={e => handleReqChanged(\"value\", convertNumberValue(e.target.value))}/>\r\n        <InputGroup.Append>\r\n          <Button variant=\"danger\" onClick={() => handleReqDeleted(props.requirement)}>Delete</Button>\r\n        </InputGroup.Append>\r\n      </InputGroup>\r\n    )\r\n  }\r\n  \r\n  function ReqGroup(props) {\r\n    const handleReqGroupDeleted = props.handleReqGroupDeleted\r\n    const handleReqGroupChanged = props.handleReqGroupChanged\r\n\r\n    const addSubGroup = () => {\r\n      const new_group = new ReqGroupData()\r\n      const new_reqs = [...props.group.requirements, new_group]\r\n      handleReqGroupChanged(\"requirements\",new_reqs)\r\n    }\r\n  \r\n    const addSubReq = () => {\r\n      const new_req = new ReqData()\r\n      const new_reqs = [...props.group.requirements, new_req]\r\n      handleReqGroupChanged(\"requirements\",new_reqs)\r\n    }\r\n  \r\n    const deleteSubReq = (deleted) =>{\r\n      const new_reqs = props.group.requirements.filter(x => x !== deleted)\r\n      handleReqGroupChanged(\"requirements\",new_reqs)\r\n    }\r\n  \r\n    const updateSubReq = (old_req,prop,new_value) =>{\r\n      const changed_req = {...old_req, [prop]:new_value}\r\n      const new_reqs = props.group.requirements.slice()\r\n      new_reqs[props.group.requirements.indexOf(old_req)] = changed_req\r\n      handleReqGroupChanged(\"requirements\",new_reqs)\r\n    }\r\n  \r\n    return (\r\n      <Card border=\"dark\">\r\n        <Card.Header>\r\n          <InputGroup>\r\n            <FormControl as=\"select\" value={props.group.group_type} onChange={e => handleReqGroupChanged(\"group_type\",e.target.value)}> \r\n              <option>AND</option>\r\n              <option>OR</option>\r\n            </FormControl>\r\n            <InputGroup.Text>Group</InputGroup.Text>\r\n            <InputGroup.Append>\r\n              <Button variant=\"danger\" onClick={() => handleReqGroupDeleted(props.group)} >Delete</Button>\r\n            </InputGroup.Append>\r\n          </InputGroup>\r\n        </Card.Header>\r\n        <ListGroup>\r\n          <ListGroup.Item>\r\n            {props.group.requirements.map(req =>{\r\n              return req.requirements ? \r\n                (<ReqGroup\r\n                  key={req.id}\r\n                  group={req}\r\n                  handleReqGroupDeleted={deleteSubReq}\r\n                  handleReqGroupChanged={(prop,new_value) => updateSubReq(req,prop,new_value)}\r\n                />) : \r\n                (<SingleReq\r\n                  key={req.id} \r\n                  requirement={req}\r\n                  handleReqDeleted={deleteSubReq}\r\n                  handleReqChanged={(prop,new_value) => updateSubReq(req,prop,new_value)}\r\n                />)\r\n            })}\r\n          </ListGroup.Item>\r\n          <ListGroup.Item>\r\n            <ButtonGroup>\r\n              <Button onClick={addSubGroup}>Add Req Group</Button>\r\n              <Button onClick={addSubReq}>Add Single Req</Button>\r\n            </ButtonGroup>\r\n          </ListGroup.Item>\r\n        </ListGroup>\r\n      </Card>\r\n    )\r\n  }","import React,{useState} from 'react'\r\nimport { Card, FormControl, Row,Container,Col, InputGroup,Button, FormGroup,Table } from 'react-bootstrap'\r\nimport {useRecoilState} from 'recoil'\r\nimport {AdventureState, NodesSelector} from '../State'\r\nimport {special_nodes} from '../ExternalDefines'\r\nimport {convertNumberValue,updateProp} from '../Helpers'\r\n\r\nexport function BasicCollapsible(props){\r\n    const [sectionCollapsed,setSectionCollapsed] = useState(props.startCollapsed)\r\n    return(\r\n        <Container>\r\n            <Row>\r\n                <Col>\r\n                    <Card.Header onClick={() => setSectionCollapsed(!sectionCollapsed)}><Container><Row><Col className=\"flex-grow\">{props.title}</Col><Col className=\"flex-grow-0\">{sectionCollapsed ? \"\" : \"\"}</Col></Row></Container></Card.Header>\r\n                </Col>\r\n            </Row>\r\n            <Row>\r\n                <Col>\r\n                    <Container className={sectionCollapsed ? \"d-none\" : \"\"}>\r\n                        <Row>\r\n                            <Col>\r\n                                {props.children}\r\n                            </Col>\r\n                        </Row>\r\n                    </Container>\r\n                </Col>\r\n            </Row>\r\n        </Container>)\r\n  }\r\n\r\n\r\nexport function NodeSelectionDropdown(props){\r\n    const {\r\n        allowNone = false,\r\n        allowCustom = true,\r\n        ...rest\r\n    } = props;\r\n\r\n    const [nodes] = useRecoilState(NodesSelector)\r\n        return (<FormControl {...rest} as=\"select\">\r\n            {nodes.map(node => (<option key={node.id}>{node.name}</option>))}\r\n            {!!allowNone && (<option value=\"\">None</option>)}\r\n            {!!allowCustom && (special_nodes.map(name => (<option key={name}>{name}</option>)))}\r\n        </FormControl>)\r\n}\r\n\r\nexport function KeyValueList(props){\r\n    const {\r\n        presetKeys,\r\n        adventureProp,\r\n    } = props;\r\n\r\n    const [adventure,setAdventure] = useRecoilState(AdventureState)\r\n    \r\n    const store = adventure[adventureProp]\r\n    const [newKey,setNewKey] = useState(presetKeys ? presetKeys[0] : \"\")\r\n    const [newValue,setNewValue] = useState(\"\")\r\n    const store_keys = Object.keys(store)\r\n\r\n    const add_new_kv_pair = () => {\r\n        const newstore = {...store,[newKey]:newValue}\r\n        setAdventure(updateProp(adventure,adventureProp,newstore))\r\n    }\r\n\r\n    const remove_key = key => {\r\n        const newstore = {...store}\r\n        delete newstore[key]\r\n        setAdventure(updateProp(adventure,adventureProp,newstore))\r\n    }\r\n    return (<Table size=\"sm\">\r\n                <thead>\r\n                    <tr>\r\n                        <th>Quality</th>\r\n                        <th>Value</th>\r\n                        <th></th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                {store_keys.map(key => (\r\n                <tr key={key}>\r\n                        <td>{key}</td>\r\n                        <td>{store[key]}</td>\r\n                        <td><Button variant=\"danger\" onClick={() => remove_key(key)}>Delete</Button></td>\r\n                </tr>\r\n                ))}\r\n                <tr>\r\n                    <td>{presetKeys ? (<FormControl as=\"select\" value={newKey} onChange={e => setNewKey(e.target.value)} >{presetKeys.map(pk => (<option key={pk}>{pk}</option>))}</FormControl>) : (<FormControl value={newKey} onChange={e => setNewKey(e.target.value)}></FormControl>)}</td>\r\n                    <td><FormControl value={newValue} onChange={e => setNewValue(convertNumberValue(e.target.value))}></FormControl></td>\r\n                    <td><Button onClick={add_new_kv_pair}>Add</Button></td>\r\n                </tr>\r\n                </tbody>\r\n            </Table>)\r\n}\r\n\r\n\r\nexport function SimpleList(props){\r\n    const {\r\n        presetValues,\r\n        adventureProp,\r\n        unique= true\r\n    } = props;\r\n\r\n    const [adventure,setAdventure] = useRecoilState(AdventureState)\r\n    const store = adventure[adventureProp] || []\r\n    const [newValue,setNewValue] = useState(presetValues ? presetValues[0] : \"\")\r\n\r\n    const add_new_value = () => {\r\n        if(unique && store.indexOf(newValue) >= 0)\r\n            return\r\n        const newstore = [...store,newValue]\r\n        setAdventure(updateProp(adventure,adventureProp,newstore))\r\n    }\r\n\r\n    const remove_value = key => {\r\n        const newstore = store.filter(x => x !== key)\r\n        setAdventure(updateProp(adventure,adventureProp,newstore))\r\n    }\r\n\r\n    return (<FormGroup>\r\n            {store.map(key => (\r\n                <InputGroup key={key}>\r\n                    <InputGroup.Text>{key}</InputGroup.Text>\r\n                    <InputGroup.Append>\r\n                        <Button variant=\"danger\" onClick={() => remove_value(key)}>X</Button>\r\n                    </InputGroup.Append>\r\n                </InputGroup>\r\n            ))}\r\n            <InputGroup>\r\n                <InputGroup.Prepend>\r\n                    {presetValues ? (<FormControl as=\"select\" value={newValue} onChange={e => setNewValue(convertNumberValue(e.target.value))} >{presetValues.map(pk => (<option key={pk}>{pk}</option>))}</FormControl>) : (<FormControl value={newValue} onChange={e => setNewValue(convertNumberValue(e.target.value))}></FormControl>)}\r\n                </InputGroup.Prepend>\r\n                <InputGroup.Append>\r\n                    <Button onClick={add_new_value}>Add</Button>\r\n                </InputGroup.Append>\r\n            </InputGroup>\r\n        </FormGroup>)\r\n}","import React,{useState} from 'react'\r\nimport {Button, Card, InputGroup, FormControl } from 'react-bootstrap'\r\nimport {EffectBuilder} from './EffectBuilder'\r\nimport {RequirementsBuilder} from './RequirementsBuilder'\r\nimport {convertNumberValue} from '../Helpers'\r\nimport { NodeSelectionDropdown } from './Utility'\r\n\r\nexport function AdventureChoice(props) {\r\n    const handleChoiceDeletion = props.handleChoiceDeletion\r\n    const handleChoiceChange = props.handleChoiceChange\r\n  \r\n  \r\n    const addEffect = (effect_prop, new_effect) => {\r\n      const old_effects = props.choice[effect_prop]\r\n      const new_effects = old_effects !== undefined ? [...old_effects, new_effect] : [new_effect]\r\n      handleChoiceChange(effect_prop, new_effects)\r\n    }\r\n    const updateEffects = (effect_prop, old_effect, changed_prop, new_value) => {\r\n      const changed_effect = { ...old_effect, [changed_prop]: new_value }\r\n      const new_effects = props.choice[effect_prop].slice()\r\n      new_effects[props.choice[effect_prop].indexOf(old_effect)] = changed_effect\r\n      handleChoiceChange(effect_prop, new_effects)\r\n    }\r\n    const deleteEffect = (effect_prop, removed) => {\r\n      const new_effects = props.choice[effect_prop].filter(x => x !== removed)\r\n      handleChoiceChange(effect_prop, new_effects.length ? new_effects : undefined)\r\n    }\r\n  \r\n  \r\n    const addRequirement = added => {\r\n      const old_reqs = props.choice.requirements\r\n      const new_reqs = old_reqs !== undefined ? [...old_reqs, added] : [added]\r\n      handleChoiceChange(\"requirements\", new_reqs)\r\n    }\r\n  \r\n    const deleteRequirement = removed => {\r\n      const new_reqs = props.choice.requirements.filter(x => x !== removed)\r\n      handleChoiceChange(\"requirements\", new_reqs.length ? new_reqs : undefined)\r\n    }\r\n  \r\n    const updateRequirements = (old_req, changed_prop, new_value) => {\r\n      const changed_req = { ...old_req, [changed_prop]: new_value }\r\n      const new_reqs = props.choice.requirements.slice()\r\n      new_reqs[props.choice.requirements.indexOf(old_req)] = changed_req\r\n      handleChoiceChange(\"requirements\", new_reqs)\r\n    }\r\n    const [exitNodeSelectValue, setExitNodeSelectValue] = useState(props.choice.exit_node);\r\n  \r\n    const changeExitNode = (e) => {\r\n      setExitNodeSelectValue(e.target.value)\r\n      handleChoiceChange(\"exit_node\", e.target.value)\r\n    }\r\n  \r\n  \r\n    return (\r\n      <Card>\r\n        <Card.Body>\r\n          <InputGroup>\r\n            <InputGroup.Prepend>\r\n              <InputGroup.Text>Choice</InputGroup.Text>\r\n            </InputGroup.Prepend>\r\n            <FormControl value={props.choice.name} onChange={(e) => handleChoiceChange(\"name\", e.target.value)} />\r\n            <InputGroup.Append>\r\n              <Button variant=\"danger\" onClick={handleChoiceDeletion}>Delete</Button>\r\n            </InputGroup.Append>\r\n          </InputGroup>\r\n          <InputGroup>\r\n            <InputGroup.Prepend>\r\n              <InputGroup.Text>Exit Node</InputGroup.Text>\r\n            </InputGroup.Prepend>\r\n            <NodeSelectionDropdown value={exitNodeSelectValue} onChange={changeExitNode} allowNone={false}/>\r\n          </InputGroup>\r\n          <InputGroup>\r\n            <InputGroup.Prepend>\r\n              <InputGroup.Text>Delay(ds)</InputGroup.Text>\r\n            </InputGroup.Prepend>\r\n            <FormControl value={props.choice.delay} onChange={(e) => handleChoiceChange(\"delay\", convertNumberValue(e.target.value))} />\r\n            <InputGroup.Text>Message</InputGroup.Text>\r\n            <FormControl value={props.choice.delay_message} onChange={(e) => handleChoiceChange(\"delay_message\", e.target.value)} />\r\n          </InputGroup>\r\n          <EffectBuilder\r\n              title=\"Selection Effects\"\r\n              effects={props.choice.on_selection_effects}\r\n              handleEffectAdded={added => addEffect(\"on_selection_effects\", added)}\r\n              handleEffectsChanged={(old, prop, new_value) => updateEffects(\"on_selection_effects\", old, prop, new_value)}\r\n              handleEffectDeleted={deleted => deleteEffect(\"on_selection_effects\", deleted)}/>\r\n          <RequirementsBuilder\r\n            title=\"Requirements\"\r\n            requirements={props.choice.requirements}\r\n            handleRequirementAdded={addRequirement}\r\n            handleRequirementDeleted={deleteRequirement}\r\n            handleRequirementsChanged={updateRequirements}\r\n          />\r\n        </Card.Body>\r\n      </Card>)\r\n  }","import React, { useRef } from 'react';\r\nimport { Button, Card,Image, FormControl, FormGroup, Form, InputGroup } from 'react-bootstrap'\r\nimport { useRecoilState } from 'recoil'\r\nimport { updateProp } from '../Helpers'\r\nimport { NodeSelector, ChoiceData } from '../State'\r\nimport { AdventureChoice } from './AdventureChoice'\r\nimport { EffectBuilder } from './EffectBuilder'\r\nimport {preset_images} from '../ExternalDefines'\r\n\r\n\r\nexport function AdventureNode(props) {\r\n    const handleNodeDeletion = props.handleNodeDeletion\r\n\r\n    const [node, setNode] = useRecoilState(NodeSelector(props.node.id))\r\n\r\n    const update_node_name = (e) => {\r\n        const modified_node = updateProp(node, \"name\", e.target.value)\r\n        setNode(modified_node)\r\n    }\r\n\r\n    const addChoice = (new_choice) => {\r\n        const new_choices = [...props.node.choices, new_choice]\r\n        setNode(updateProp(node, \"choices\", new_choices))\r\n    }\r\n\r\n    const removeChoice = (removed) => {\r\n        const new_choices = props.node.choices.filter(x => x !== removed)\r\n        setNode(updateProp(node, \"choices\", new_choices))\r\n    }\r\n    const updateChoice = (old_choice, new_choice) => {\r\n        const new_choices = props.node.choices.slice()\r\n        new_choices[props.node.choices.indexOf(old_choice)] = new_choice\r\n        setNode(updateProp(node, \"choices\", new_choices))\r\n    }\r\n\r\n    const addEffect = (effect_prop, new_effect) => {\r\n        const old_effects = props.node[effect_prop]\r\n        const new_effects = old_effects !== undefined ? [...old_effects, new_effect] : [new_effect]\r\n        setNode(updateProp(node, effect_prop, new_effects))\r\n    }\r\n\r\n    const updateEffects = (effect_prop, old_effect, changed_prop, new_value) => {\r\n        const changed_effect = { ...old_effect, [changed_prop]: new_value }\r\n        const new_effects = props.node[effect_prop].slice()\r\n        new_effects[props.node[effect_prop].indexOf(old_effect)] = changed_effect\r\n        setNode(updateProp(node, effect_prop, new_effects))\r\n    }\r\n\r\n    const deleteEffect = (effect_prop, removed) => {\r\n        const new_effects = props.node[effect_prop].filter(x => x !== removed)\r\n        setNode(updateProp(node, effect_prop, new_effects.length ? new_effects : undefined))\r\n    }\r\n\r\n    const current_image = node.raw_image ? node.raw_image : preset_images[node.image]\r\n    const imageInput = useRef()\r\n    const try_uploading_image = () => {\r\n        imageInput.current.click() //god why\r\n    }\r\n\r\n    const setUploadedImage = (e) => {\r\n        var reader = new FileReader()\r\n        reader.onload = (e) => {\r\n            var uploaded_image = document.createElement('img');\r\n            uploaded_image.onload = () =>{\r\n                if(uploaded_image.width !== 200 || uploaded_image.height !== 100){\r\n                    alert(`Adventure images need to be be 200x100 pngs.`)\r\n                    return\r\n                }\r\n                const modified_node = {...node,\r\n                    raw_image:e.target.result,\r\n                    image:null\r\n                }\r\n                setNode(modified_node)\r\n            }\r\n            uploaded_image.src = e.target.result\r\n        }\r\n        reader.readAsDataURL(e.target.files[0])\r\n    }\r\n\r\n    const reset_image = () => {\r\n        const modified_node = {...node,\r\n            raw_image:undefined,\r\n            image:\"default\"\r\n        }\r\n        setNode(modified_node)\r\n    }\r\n\r\n    const update_image = e => {\r\n        setNode(updateProp(node,\"image\",e.target.value))\r\n    }\r\n\r\n    const image_name_text = node.raw_image ? \"custom image data\" : node.image\r\n    return (\r\n        <>\r\n                    <Card>\r\n                        <Card.Body>\r\n                            <Card.Title>{node.name} <Button variant=\"danger\" onClick={handleNodeDeletion}>Delete</Button></Card.Title>\r\n                            <Image src={current_image} width=\"400px\" height=\"200px\"/>\r\n                            <InputGroup>\r\n                                <InputGroup.Prepend>\r\n                                    <InputGroup.Text>Image</InputGroup.Text>\r\n                                </InputGroup.Prepend>\r\n                                <Form.Control as=\"select\" value={image_name_text} readOnly={node.raw_image !== undefined} onChange={update_image}>\r\n                                    {Object.keys(preset_images).map(k => (<option key={k}>{k}</option>))}\r\n                                    </Form.Control>\r\n                                <Form.File type='file' accept=\"image/png\" ref={imageInput} onChange={setUploadedImage} style={{display:\"none\"}}/>\r\n                                <InputGroup.Append>\r\n                                    <Button onClick={try_uploading_image}>Custom</Button>\r\n                                    <Button onClick={reset_image}>Reset</Button>\r\n                                </InputGroup.Append>\r\n                            </InputGroup>\r\n                            <FormGroup>\r\n                                <Form.Label>Node ID</Form.Label>\r\n                                <FormControl value={node.name} onChange={update_node_name} />\r\n                            </FormGroup>\r\n                            <FormGroup>\r\n                                <Form.Label>Description</Form.Label>\r\n                                <FormControl as=\"textarea\" rows={5} placeholder=\"Describe whatever here.\" value={node.description} onChange={(e) => setNode(updateProp(node, \"description\", e.target.value))} />\r\n                            </FormGroup>\r\n                            <EffectBuilder\r\n                                title=\"On Enter Effects\"\r\n                                effects={node.on_enter_effects}\r\n                                handleEffectAdded={added => addEffect(\"on_enter_effects\", added)}\r\n                                handleEffectsChanged={(old, prop, new_value) => updateEffects(\"on_enter_effects\", old, prop, new_value)}\r\n                                handleEffectDeleted={deleted => deleteEffect(\"on_enter_effects\", deleted)} />\r\n                            <EffectBuilder\r\n                                title=\"On Exit Effects\"\r\n                                effects={node.on_exit_effects}\r\n                                parent_id={node.id}\r\n                                handleEffectAdded={added => addEffect(\"on_exit_effects\", added)}\r\n                                handleEffectsChanged={(old, prop, new_value) => updateEffects(\"on_exit_effects\", old, prop, new_value)}\r\n                                handleEffectDeleted={deleted => deleteEffect(\"on_exit_effects\", deleted)} />\r\n                            <Card.Header>Choices</Card.Header>\r\n                                {node.choices.map(choice => (\r\n                                        <AdventureChoice\r\n                                            key={choice.id}\r\n                                            choice={choice}\r\n                                            handleChoiceDeletion={() => removeChoice(choice)}\r\n                                            handleChoiceChange={(choice_property, new_value) => {\r\n                                                const new_choice = { ...choice, [choice_property]: new_value }\r\n                                                updateChoice(choice, new_choice)\r\n                                            }}\r\n                                        />))}\r\n                                <Button onClick={() => addChoice(new ChoiceData())}>Add Choice</Button>\r\n                        </Card.Body>\r\n                    </Card>\r\n            </>\r\n    )\r\n}","import React from 'react';\r\nimport { Button, Card, FormControl, FormGroup, Form } from 'react-bootstrap'\r\nimport { useRecoilState } from 'recoil'\r\nimport { updateProp } from '../Helpers'\r\nimport { TriggerSelector } from '../State'\r\nimport { RequirementsBuilder } from './RequirementsBuilder'\r\nimport { EffectBuilder } from './EffectBuilder'\r\nimport {NodeSelectionDropdown} from './Utility'\r\n\r\n\r\nexport function AdventureTrigger(props) {\r\n    const handleDeletion = props.handleDeletion\r\n\r\n    const [trigger, setTrigger] = useRecoilState(TriggerSelector(props.trigger.id))\r\n\r\n    const update_trigger_name = (e) => {\r\n        setTrigger(updateProp(trigger, \"name\", e.target.value))\r\n    }\r\n\r\n    const update_trigger_target_node = (e) => {\r\n        setTrigger(updateProp(trigger, \"target_node\", e.target.value))\r\n    }\r\n\r\n    const addEffect = (effect_prop, new_effect) => {\r\n        const old_effects = props.trigger[effect_prop]\r\n        const new_effects = old_effects !== undefined ? [...old_effects, new_effect] : [new_effect]\r\n        setTrigger(updateProp(trigger, effect_prop, new_effects))\r\n    }\r\n\r\n    const updateEffects = (effect_prop, old_effect, changed_prop, new_value) => {\r\n        const changed_effect = { ...old_effect, [changed_prop]: new_value }\r\n        const new_effects = props.trigger[effect_prop].slice()\r\n        new_effects[props.trigger[effect_prop].indexOf(old_effect)] = changed_effect\r\n        setTrigger(updateProp(trigger, effect_prop, new_effects))\r\n    }\r\n\r\n    const deleteEffect = (effect_prop, removed) => {\r\n        const new_effects = props.trigger[effect_prop].filter(x => x !== removed)\r\n        setTrigger(updateProp(trigger, effect_prop, new_effects.length ? new_effects : undefined))\r\n    }\r\n\r\n    const addRequirement = added => {\r\n        const old_reqs = props.trigger.requirements\r\n        const new_reqs = old_reqs !== undefined ? [...old_reqs, added] : [added]\r\n        setTrigger(updateProp(trigger,\"requirements\", new_reqs))\r\n    }\r\n\r\n    const deleteRequirement = removed => {\r\n        const new_reqs = props.trigger.requirements.filter(x => x !== removed)\r\n        setTrigger(updateProp(trigger,\"requirements\",  new_reqs.length ? new_reqs : undefined))\r\n    }\r\n\r\n    const updateRequirements = (old_req, changed_prop, new_value) => {\r\n        const changed_req = { ...old_req, [changed_prop]: new_value }\r\n        const new_reqs = props.trigger.requirements.slice()\r\n        new_reqs[props.trigger.requirements.indexOf(old_req)] = changed_req\r\n        setTrigger(updateProp(trigger,\"requirements\",  new_reqs))\r\n    }\r\n\r\n\r\n    return (\r\n        <Card>\r\n            <Card.Body>\r\n                <Card.Title>Trigger <Button variant=\"danger\" onClick={handleDeletion}>Delete</Button></Card.Title>\r\n                <FormGroup>\r\n                    <Form.Label>Trigger ID</Form.Label>\r\n                    <FormControl value={trigger.name} onChange={update_trigger_name} />\r\n                </FormGroup>\r\n                <FormGroup>\r\n                    <Form.Label>Target Node On Trigger</Form.Label>\r\n                    <NodeSelectionDropdown allowNone={true} value={trigger.target_node} onChange={update_trigger_target_node}/>\r\n                </FormGroup>\r\n                <EffectBuilder\r\n                    title=\"On Trigger Effects\"\r\n                    effects={trigger.on_trigger_effects}\r\n                    handleEffectAdded={added => addEffect(\"on_trigger_effects\", added)}\r\n                    handleEffectsChanged={(old, prop, new_value) => updateEffects(\"on_trigger_effects\", old, prop, new_value)}\r\n                    handleEffectDeleted={deleted => deleteEffect(\"on_trigger_effects\", deleted)} />\r\n                <RequirementsBuilder\r\n                    title=\"Trigger Requirements\"\r\n                    requirements={props.trigger.requirements}\r\n                    handleRequirementAdded={addRequirement}\r\n                    handleRequirementDeleted={deleteRequirement}\r\n                    handleRequirementsChanged={updateRequirements}\r\n                />\r\n            </Card.Body>\r\n        </Card>\r\n\r\n    )\r\n}","import React, { useState } from 'react';\r\nimport { Button, Col, Container, Row, Card,Alert,Table } from 'react-bootstrap'\r\nimport {preset_images,EffectTypes,ValueTypes} from '../ExternalDefines'\r\nimport {useRecoilState} from 'recoil'\r\nimport { AdventureState } from '../State';\r\n\r\n\r\nexport function AdventurePlayer(props) {\r\n\r\n    const [adventure] = useRecoilState(AdventureState)\r\n\r\n    const [currentNode,setCurrentNode] = useState(adventure.nodes.find(node => node.name === adventure.starting_node) || adventure.nodes[0])\r\n    const [qualities,setQualities] = useState(adventure.starting_qualities)\r\n    const [prevNode,setPrevNode] = useState(currentNode ? currentNode.name : \"\")\r\n    \r\n    const restart_test = () => {\r\n        setCurrentNode(adventure.nodes.find(node => node.name === adventure.starting_node) || adventure.nodes[0])\r\n        setQualities(adventure.starting_qualities)\r\n        setPrevNode(currentNode.name)\r\n    }\r\n\r\n    const checkReq = req => {\r\n        switch(req.operator){\r\n            case \"==\":\r\n                if(qualities[req.quality] === req.value)\r\n                    return true\r\n                break\r\n            case \"!=\":\r\n                if(qualities[req.quality] !== req.value)\r\n                    return true\r\n                break\r\n            case \"<=\":\r\n                if(qualities[req.quality] <= req.value)\r\n                    return true\r\n                break\r\n            case \">=\":\r\n                if(qualities[req.quality] >= req.value)\r\n                    return true\r\n                break\r\n            case \">\":\r\n                if(qualities[req.quality] > req.value)\r\n                    return true\r\n                break\r\n            case \"<\":\r\n                if(qualities[req.quality] < req.value)\r\n                    return true\r\n                break\r\n            default:\r\n                alert(\"Unknown operator\")\r\n        }\r\n    }\r\n\r\n    const check_group = (req_group,group_type) => {\r\n        switch(group_type){\r\n            case \"AND\":\r\n                for(let req of req_group){\r\n                    if(req.group_type !== undefined){\r\n                        if(!check_group(req.requirements,req.group_type))\r\n                            return false;\r\n                    }\r\n                    if(!checkReq(req))\r\n                        return false\r\n                }\r\n                return true;\r\n            case \"OR\":\r\n                for(let req of req_group){\r\n                    if(req.group_type !== undefined){\r\n                        if(check_group(req,req.group_type))\r\n                            return true;\r\n                    }\r\n                    if(checkReq(req))\r\n                        return true;\r\n                }\r\n                return false;\r\n            default:\r\n                alert(\"wrong group_type\")\r\n        }\r\n    }\r\n\r\n    const checkChoice = choice => {\r\n        if(choice.requirements === undefined)\r\n            return true\r\n        return check_group(choice.requirements,\"AND\")\r\n    }\r\n\r\n    const navigateToNode = node_name => {\r\n        if(currentNode.on_exit_effects !== undefined){\r\n            if(apply_effects(currentNode.on_exit_effects))\r\n                return\r\n        }\r\n        switch(node_name){\r\n            case \"WIN\":\r\n                alert(\"Here you would complete the adventure in real game and recieve loot.\")\r\n                break\r\n            case \"FAIL\":\r\n                alert(\"Here you would lose the adventure in real game and get dealt half integrity as damage.\")\r\n                break\r\n            case \"FAIL_DEATH\":\r\n                alert(\"Here you would lose the adventure in real game and blown up.\")\r\n                break\r\n            case \"GO_BACK\":\r\n                navigateToNode(prevNode.name)\r\n                break\r\n            default:\r\n                const next_node = adventure.nodes.find(node => node.name === node_name)\r\n                setCurrentNode(next_node)\r\n                if(prevNode !== next_node.name)\r\n                    setPrevNode(next_node.name)\r\n                if(next_node.on_enter_effects !== undefined){\r\n                    if(apply_effects(next_node.on_enter_effects))\r\n                        return\r\n                }\r\n        }\r\n    }\r\n    const triggerGuard = []\r\n    const checkTriggers = () => {\r\n        if(adventure.triggers !== undefined){\r\n            for (let trigger of adventure.triggers) {\r\n                if(!check_group(trigger.requirements,\"AND\"))\r\n                    continue\r\n                if(triggerGuard.includes(trigger)){\r\n                    alert(`Recursive trigger detected. ${trigger.name}`)\r\n                    continue\r\n                }\r\n                triggerGuard.push(trigger)\r\n                if(trigger.on_trigger_effects !== undefined){\r\n                    if(apply_effects(trigger.on_trigger_effects))\r\n                        return true\r\n                }\r\n                if(trigger.target_node !== undefined)\r\n                    navigateToNode(trigger.target_node)\r\n                    return true\r\n            }\r\n        }\r\n        triggerGuard.length = 0\r\n        return false;\r\n    }\r\n\r\n    ///thanks mdn\r\n    const getRandomInt = (min, max) => {\r\n        min = Math.ceil(min);\r\n        max = Math.floor(max);\r\n        return Math.floor(Math.random() * (max - min) + min); //The maximum is exclusive and the minimum is inclusive\r\n    }\r\n\r\n    const extractValue = value => {\r\n        if(value === Object(value)){\r\n            switch(value.value_type){\r\n                case ValueTypes.random:\r\n                    return getRandomInt(value.low,value.high)\r\n                default:\r\n                    alert(\"wrong value type\")\r\n            }\r\n        }\r\n        return value;\r\n    }\r\n\r\n    const apply_effects = effect_list => {\r\n        for (let effect of effect_list) {\r\n            const extractedValue = extractValue(effect.value)\r\n            switch(effect.effect_type){\r\n                case EffectTypes.Add:\r\n                    const a = {...qualities,[effect.quality]:(qualities[effect.quality] || 0)+extractedValue}\r\n                    setQualities(a)\r\n                    break;\r\n                case EffectTypes.Set:\r\n                    const b = {...qualities,[effect.quality]:extractedValue}\r\n                    setQualities(b)\r\n                    break;\r\n                case EffectTypes.Remove:\r\n                    const c = {...qualities}\r\n                    delete c[effect.quality]\r\n                    setQualities(c)\r\n                    break;\r\n                default:\r\n                    alert(\"wrong effect type\")\r\n            }\r\n        }\r\n        if(checkTriggers())\r\n            return true\r\n        return false;\r\n    }\r\n\r\n    const selectChoice = (choice) => {\r\n        if(choice.on_selection_effects !== undefined){\r\n            if(apply_effects(choice.on_selection_effects))\r\n                return\r\n        }\r\n        navigateToNode(choice.exit_node)\r\n    }\r\n\r\n    if(!currentNode)\r\n        return (<Alert variant=\"danger\">You need at least one node to play.</Alert>)\r\n\r\n    return (\r\n        <Container>\r\n            <Alert variant=\"danger\">Delays are not implemented. Choices shown as disabled would not be visible in-game</Alert>\r\n            <Row>\r\n                <Col>\r\n                    <Button onClick={restart_test}>Restart</Button>\r\n                </Col>\r\n            </Row>\r\n            <Row>\r\n                <Col>\r\n                    <Card>\r\n                        <Card.Img src={currentNode.raw_image ? currentNode.raw_image : preset_images[currentNode.image]}/>\r\n                        <Card.Body>\r\n                            <Card.Text>{currentNode.description}</Card.Text>\r\n                            <Container>\r\n                                {currentNode.choices.map(choice => (\r\n                                    <Row key={choice.id}><Col><Button disabled={!checkChoice(choice)} onClick={() => selectChoice(choice)}>{choice.name}</Button></Col></Row>\r\n                                ))}\r\n                            </Container>\r\n                        </Card.Body>\r\n                    </Card>\r\n                </Col>\r\n            </Row>\r\n            <Row>\r\n                <Table>\r\n                    <thead>\r\n                        <tr>\r\n                            <th>Quality</th>\r\n                            <th>Value</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        {Object.keys(qualities).map(qname => (<tr key={qname}><td>{qname}</td><td>{qualities[qname]}</td></tr>)) }\r\n                    </tbody>\r\n                </Table>\r\n            </Row>\r\n        </Container>\r\n    )\r\n}","import React,{useRef, useState} from 'react'\r\nimport { Button, Col, Container, Row, Tab, Nav, FormControl, FormGroup, Form, ButtonGroup,Modal } from 'react-bootstrap'\r\nimport {useRecoilState} from 'recoil'\r\nimport {AdventureState,NodesSelector,NodeData,TriggersSelector,TriggerData, unique_id} from './../State'\r\nimport {updateProp} from './../Helpers'\r\nimport {AdventureNode} from './AdventureNode'\r\nimport {AdventureTrigger} from './AdventureTrigger'\r\nimport {BasicCollapsible,NodeSelectionDropdown, KeyValueList, SimpleList} from './Utility'\r\nimport {scan_bands, loot_types, site_traits} from '../ExternalDefines'\r\nimport { AdventurePlayer } from './AdventurePlayer'\r\n\r\n\r\nexport function AdventureEditor() {\r\n    const [adventure,setAdventure] = useRecoilState(AdventureState);\r\n    const [nodes] = useRecoilState(NodesSelector)\r\n    const [triggers] = useRecoilState(TriggersSelector)\r\n\r\n    const [activeTab,setActiveTab] = useState(\"\")\r\n    const [draggedItem,setDraggedItem] = useState(null)\r\n   \r\n    const add_node = () => {\r\n      const modified_adventure = {...adventure,\r\n        nodes:[...nodes,new NodeData()]\r\n      }\r\n      setAdventure(modified_adventure)\r\n    }\r\n    const delete_node = (node) => {\r\n      const changed_nodes = nodes.filter(x => x !== node)\r\n      setAdventure(updateProp(adventure,\"nodes\",changed_nodes))\r\n    }\r\n\r\n    const add_trigger = () => {\r\n      const modified_adventure = {...adventure,\r\n        triggers:[...triggers,new TriggerData()]\r\n      }\r\n      setAdventure(modified_adventure)\r\n\r\n    }\r\n    const delete_trigger = (trigger) => {\r\n      const changed_triggers = triggers.filter(x => x !== trigger)\r\n      setAdventure(updateProp(adventure,\"triggers\",changed_triggers))\r\n      \r\n    }\r\n\r\n    \r\n    const handleExport = () => {\r\n      const data_object = {\r\n        adventure_name: adventure.name,\r\n        author : adventure.author,\r\n        starting_node: startingNode,\r\n        starting_qualities: adventure.starting_qualities,\r\n        required_site_traits: adventure.required_site_traits,\r\n        loot_categories : adventure.loot_types,\r\n        scan_band_mods : adventure.band_modifiers,\r\n        deep_scan_description : adventure.deep_scan_description,\r\n        triggers : adventure.triggers,\r\n        nodes: nodes\r\n      }\r\n      //Internal stuff, byond doesn't care about this\r\n      const remove_ids = (key, value) => {\r\n        if (key === \"id\")\r\n          return undefined\r\n        return value;\r\n      }\r\n      const blob = new Blob([JSON.stringify(data_object, remove_ids)], { type: 'application/json' })\r\n      const blob_url = URL.createObjectURL(blob)\r\n      \r\n      ExportLink.current.href = blob_url\r\n      ExportLink.current.download = `${adventure.name}.json`\r\n      ExportLink.current.click();\r\n    }\r\n\r\n    const regenerate_reqs = req_list => {\r\n      for(var req of req_list){\r\n        req.id = unique_id(\"req\")\r\n        if(req.group_type !== undefined){\r\n          if(req.requirements !== undefined)\r\n            regenerate_reqs(req.requirements)\r\n        }\r\n      }\r\n    }\r\n\r\n    const regenerate_effects = effects => {\r\n      for(var effect of effects){\r\n        effect.id = unique_id(\"effect\")\r\n      }\r\n    }\r\n    /// Regenerates temporary ids\r\n    const regenerate_ids = node_list =>{\r\n      for(var node of node_list){\r\n        node.id = unique_id(\"Node\")\r\n        for(var choice of node.choices){\r\n          choice.id = unique_id(\"choice\")\r\n          if(choice.on_selection_effects !== undefined){\r\n            regenerate_effects(choice.on_selection_effects)\r\n          }\r\n          if(choice.requirements !== undefined){\r\n            regenerate_reqs(choice.requirements)\r\n          }\r\n        }\r\n        if(node.on_enter_effects !== undefined)\r\n          regenerate_effects(node.on_enter_effects)\r\n        if(node.on_exit_effects !== undefined)\r\n          regenerate_effects(node.on_exit_effects)\r\n      }\r\n      return node_list\r\n    }\r\n\r\n    const regenerate_trigger_ids = trigger_list => {\r\n      for(var trigger of trigger_list){\r\n        trigger.id = unique_id(\"trigger\")\r\n        if(trigger.requirements !== undefined){\r\n          regenerate_reqs(trigger.requirements)\r\n        }\r\n        if(trigger.on_trigger_effects !== undefined){\r\n          regenerate_effects(trigger.on_trigger_effects)\r\n        }\r\n      }\r\n      return trigger_list\r\n    }\r\n  \r\n    const handleImport = e => {\r\n      var reader = new FileReader()\r\n      reader.onload = (e) =>{\r\n        const result = JSON.parse(e.target.result)\r\n\r\n        const reindexed_nodes = regenerate_ids(result.nodes)\r\n        const reindexed_triggers = regenerate_trigger_ids(result.triggers)\r\n\r\n        const modified_adventure = {...adventure,\r\n          name:result.adventure_name,\r\n          author : result.author,\r\n          starting_node:result.starting_node,\r\n          starting_qualities:result.starting_qualities,\r\n          required_site_traits:result.required_site_traits,\r\n          band_modifiers:result.scan_band_mods,\r\n          loot_types:result.loot_categories,\r\n          triggers:reindexed_triggers,\r\n          nodes:reindexed_nodes\r\n        }\r\n        setAdventure(modified_adventure)\r\n      }\r\n      reader.readAsText(e.target.files[0])\r\n    }\r\n\r\n    const ImportInput = useRef()\r\n    const clickImport = () => {\r\n      ImportInput.current.click()\r\n    }\r\n\r\n    const ExportLink = useRef()\r\n\r\n    const start_dragging = (e,node) => {\r\n      setDraggedItem(node)\r\n    } \r\n\r\n    const end_dragging = () => {\r\n      setDraggedItem(null)\r\n    }\r\n\r\n    const switch_node = (node) => {\r\n      if(draggedItem != null){\r\n        const index_a = nodes.indexOf(node)\r\n        const index_b = nodes.indexOf(draggedItem)\r\n        const modified_nodes = nodes.slice();\r\n        [modified_nodes[index_a],modified_nodes[index_b]] = [modified_nodes[index_b],modified_nodes[index_a]]\r\n        setAdventure(updateProp(adventure,\"nodes\",modified_nodes))\r\n      }\r\n    }\r\n\r\n    const validate_drop = (e,node) => {\r\n      if(draggedItem != null && node !== draggedItem){\r\n        e.preventDefault()\r\n      }\r\n    }\r\n\r\n    const getDefaultTab = () => {\r\n      if(nodes.length)\r\n        return nodes[0].id.toString()\r\n    }\r\n    const openTab = activeTab || getDefaultTab()\r\n    \r\n    const getDefaultStartingNode = () => {\r\n      if(nodes.length)\r\n        return nodes[0].name\r\n    }\r\n    const startingNode = adventure.starting_node || getDefaultStartingNode()\r\n\r\n\r\n    const [playing,setPlaying] = useState(false)\r\n\r\n    const toggle_playing = () => {\r\n      setPlaying(!playing)\r\n    }\r\n\r\n    return (\r\n    <>\r\n    <Modal show={playing} onHide={toggle_playing}>\r\n      <AdventurePlayer adventure={adventure}/>\r\n    </Modal>\r\n    <Container>\r\n      <Row>\r\n        <Col>\r\n        <ButtonGroup>\r\n            <Button onClick={handleExport}>Export</Button>\r\n            <a ref={ExportLink} style={{display:\"none\"}} href=\"/\">God is this really how JS supposed to work</a>\r\n            <Button onClick={clickImport}>Import</Button>\r\n            <Form.File\r\n              onChange={handleImport}\r\n              accept=\".json\"\r\n              ref={ImportInput}\r\n              style ={{display:\"none\"}}/>\r\n            <Button onClick={toggle_playing}>Test</Button>\r\n        </ButtonGroup>\r\n        </Col>\r\n      </Row>\r\n      <Row>\r\n        <Col>\r\n        <BasicCollapsible title=\"Adventure Config\">\r\n            <Form>\r\n              <FormGroup>\r\n                <Form.Label>Adventure name</Form.Label>\r\n                <FormControl placeholder=\"New adventure\" value={adventure.name} onChange={(e) => setAdventure(updateProp(adventure,\"name\",e.target.value))} />\r\n              </FormGroup>\r\n              <FormGroup>\r\n                <Form.Label>Author</Form.Label>\r\n                <FormControl value={adventure.author} onChange={(e) => setAdventure(updateProp(adventure,\"author\",e.target.value))} />\r\n              </FormGroup>\r\n              <FormGroup>\r\n                <Form.Label>Starting node</Form.Label>\r\n                <NodeSelectionDropdown value={startingNode} onChange={(e) => setAdventure(updateProp(adventure,\"starting_node\",e.target.value))} allowCustom={false}/>\r\n              </FormGroup>\r\n              <FormGroup>\r\n                <Form.Label>Starting qualities</Form.Label>\r\n                <KeyValueList adventureProp=\"starting_qualities\"/>\r\n              </FormGroup>\r\n              <FormGroup>\r\n                <Form.Label>Required site traits</Form.Label>\r\n                <SimpleList presetValues={site_traits} adventureProp=\"required_site_traits\"/>\r\n              </FormGroup>\r\n              <FormGroup>\r\n                <Form.Label>Loot type</Form.Label>\r\n                <SimpleList presetValues={loot_types} adventureProp=\"loot_types\"/>\r\n              </FormGroup>\r\n              <FormGroup>\r\n                <Form.Label>Scanning modifiers</Form.Label>\r\n                <KeyValueList presetKeys={scan_bands} adventureProp=\"band_modifiers\"/>\r\n              </FormGroup>\r\n              <FormGroup>\r\n                <Form.Label>Deep scan description</Form.Label>\r\n                <FormControl value={adventure.deep_scan_description} onChange={(e) => setAdventure(updateProp(adventure,\"deep_scan_description\",e.target.value))} />\r\n              </FormGroup>\r\n            </Form>\r\n        </BasicCollapsible>\r\n        </Col>\r\n      </Row>\r\n      <Row>\r\n        <Col>\r\n          <BasicCollapsible title=\"Nodes\">\r\n          <Tab.Container id=\"nodes\" activeKey={openTab} onSelect={e => setActiveTab(e)}>\r\n            <Row>\r\n              <Col>\r\n                <Nav variant=\"tabs\">\r\n                  {nodes.map(node => (\r\n                    <Nav.Item \r\n                      key={node.id} \r\n                      draggable \r\n                      onDragEnd={e => end_dragging(e,node)} \r\n                      onDragStart={e => start_dragging(e,node)} \r\n                      onDrop={() => switch_node(node)}\r\n                      onDragOver={e => validate_drop(e,node)}\r\n                      >\r\n                      <Nav.Link eventKey={node.id}>{node.name}</Nav.Link>\r\n                    </Nav.Item>))}\r\n                  <Nav.Item>\r\n                    <Nav.Link onClick={add_node}>Add Node</Nav.Link>\r\n                  </Nav.Item>\r\n                </Nav>\r\n              </Col>\r\n            </Row>\r\n            <Row>\r\n              <Col>\r\n                <Tab.Content>\r\n                    {nodes.map(node => (\r\n                      <Tab.Pane eventKey={node.id} key={node.id}>\r\n                        <AdventureNode \r\n                          node={node}\r\n                          handleNodeDeletion={() => delete_node(node)}\r\n                          />\r\n                      </Tab.Pane>))}\r\n                  </Tab.Content>\r\n              </Col>\r\n            </Row>\r\n          </Tab.Container>\r\n          </BasicCollapsible>\r\n        </Col>\r\n      </Row>\r\n      <Row>\r\n        <Col>\r\n        <BasicCollapsible title=\"Triggers\" startCollapsed>\r\n          <Container>\r\n            <Row>\r\n              {triggers.map(trigger => (\r\n                <Col key={trigger.id} xl=\"auto\"><AdventureTrigger trigger={trigger} handleDeletion={() => delete_trigger(trigger)}/></Col>\r\n              ))}\r\n              <Col>\r\n                <Button onClick={add_trigger}>Add Trigger</Button>\r\n              </Col>\r\n            </Row>\r\n          </Container>\r\n        </BasicCollapsible>\r\n        </Col>\r\n      </Row>\r\n    </Container></>)\r\n  }","import './App.css';\r\nimport {RecoilRoot} from 'recoil'\r\nimport {AdventureEditor} from './Components/AdventureEditor'\r\n\r\n/*\r\nTODO:\r\nBasic validation of loops/invalid node ids and such.\r\nStyling this to look good aaahhh!!!\r\n*/\r\n\r\nfunction App(){\r\n  return (\r\n    <RecoilRoot>\r\n      <AdventureEditor/>\r\n    </RecoilRoot>\r\n  )\r\n}\r\n\r\nexport default App;\r\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport 'bootstrap/dist/css/bootstrap.css';\r\nimport './index.css';\r\nimport App from './App';\r\nimport reportWebVitals from './reportWebVitals';\r\n\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}